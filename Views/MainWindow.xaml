<Window x:Class="RealEstateAgency.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="EstatePro Manager" Height="720" Width="1280"
        WindowStartupLocation="CenterScreen"
        Background="#E9F4FF">

    <Window.Resources>
        
        <Style x:Key="SidebarToggleButtonStyle" TargetType="ToggleButton">
            <Setter Property="Background" Value="#1E3A63"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="Padding" Value="20,10"/>
            <Setter Property="Margin" Value="0,5,0,5"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Border Background="{TemplateBinding Background}" CornerRadius="6" Padding="{TemplateBinding Padding}">
                            <ContentPresenter VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#4A5E85"/>
                </Trigger>
                <Trigger Property="IsChecked" Value="True">
                    <Setter Property="Background" Value="#0F1F36"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Стили для кнопок действий -->
        <Style x:Key="ActionButtonStyle" TargetType="Button">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Height" Value="35"/>
            <Setter Property="Width" Value="120"/>
            <Setter Property="Margin" Value="5,0,0,0"/>
            <Setter Property="Padding" Value="5"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="6" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Opacity" Value="0.85"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        
        <Style x:Key="FilterLabelStyle" TargetType="TextBlock">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,0,10,0"/>
            <Setter Property="Width" Value="100"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>

        <Style x:Key="FilterComboBoxStyle" TargetType="ComboBox">
            <Setter Property="Height" Value="35"/>
            <Setter Property="Width" Value="150"/>
            <Setter Property="Margin" Value="0,0,20,0"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="BorderBrush" Value="#1E3A63"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>

        <Style x:Key="FilterTextBoxStyle" TargetType="TextBox">
            <Setter Property="Height" Value="35"/>
            <Setter Property="Width" Value="120"/>
            <Setter Property="Margin" Value="0,0,10,0"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="BorderBrush" Value="#1E3A63"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="5"/>
        </Style>

        <Style x:Key="FilterButtonStyle" TargetType="Button">
            <Setter Property="Height" Value="35"/>
            <Setter Property="Width" Value="120"/>
            <Setter Property="Margin" Value="5,0,0,0"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>

   
        <Style x:Key="ObjectCardStyle" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Margin" Value="10"/>
            <Setter Property="Width" Value="280"/>
            <Setter Property="Height" Value="320"/>
            <Setter Property="VerticalAlignment" Value="Top"/>
        </Style>

        <Style x:Key="CardButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#4CAF50"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="6"
                                Cursor="Hand">
                            <ContentPresenter HorizontalAlignment="Center" 
                                              VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#45a049"/>
                </Trigger>
            </Style.Triggers>
        </Style>

       
        <DataTemplate x:Key="ObjectCardTemplate">
            <Border Style="{StaticResource ObjectCardStyle}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="150"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                   
                    <Border Grid.Row="0" CornerRadius="8,8,0,0" Background="#F8F9FA">
                        <Image Source="{Binding MainPhotoUrl}" 
                               Stretch="UniformToFill"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Center"
                               MaxHeight="150"/>
                    </Border>

                    <StackPanel Grid.Row="1" Margin="12" VerticalAlignment="Top">
                        <!-- Адрес -->
                        <TextBlock Text="{Binding Address}" 
                                   FontWeight="Bold"
                                   FontSize="14"
                                   TextWrapping="Wrap"
                                   Foreground="#1E3A63"
                                   Margin="0,0,0,6"
                                   MaxHeight="40"
                                   TextTrimming="CharacterEllipsis"/>

              
                        <TextBlock FontSize="12" Foreground="#555555" Margin="0,0,0,8">
                            <Run Text="{Binding RoomCount, StringFormat={}{0}к.}"/>
                            <Run Text=" • "/>
                            <Run Text="{Binding Area, StringFormat={}{0} м²}"/>
                            <Run Text=" • "/>
                            <Run Text="{Binding TypeOfSubjectName}"/>
                            <Run Text="{Binding Price, StringFormat={}{0:N0} ₽}"/>
                        </TextBlock>

                        <TextBlock Text="{Binding OwnerName}" 
                                   FontSize="12"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,8"
                                   Foreground="#666666"
                                   TextTrimming="CharacterEllipsis"/>

                   
                        <WrapPanel Margin="0,4,0,0">
                            <Border Background="#E8F5E9" CornerRadius="4" Padding="6,3" Margin="0,0,5,5">
                                <TextBlock Text="{Binding TypeOfDealName}" 
                                           FontWeight="Bold"
                                           FontSize="11"
                                           Foreground="#1E6F5C"/>
                            </Border>

                            <Border Background="#E3F2FD" CornerRadius="4" Padding="6,3" Margin="0,0,5,5">
                                <TextBlock Text="{Binding StatusName}" 
                                           FontWeight="SemiBold"
                                           FontSize="11"
                                           Foreground="#0D47A1"/>
                            </Border>
                        </WrapPanel>
                    </StackPanel>

                    <Border Grid.Row="2" Background="#F8F9FA" CornerRadius="0,0,8,8" Padding="10">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <!-- Цена -->
                            <TextBlock Grid.Column="0" 
                                       Text="{Binding Price, StringFormat={}{0:N0} ₽}" 
                                       FontWeight="Bold"
                                       FontSize="16"
                                       Foreground="#2E7D32"
                                       VerticalAlignment="Center"/>

                            <Button Content="Забронировать"
                            Style="{StaticResource CardButtonStyle}"
                            Command="{Binding DataContext.BookObjectCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                            CommandParameter="{Binding}"
                            Click="BookButton_Click"/>
                        </Grid>
                    </Border>
                </Grid>
            </Border>
        </DataTemplate>

        
    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="240"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

      
        <Border Background="#13294B" CornerRadius="0,20,20,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

      
                <StackPanel Margin="20">
                    <Ellipse Width="60" Height="60" Fill="#D9D9D9"/>
                    <TextBlock Text="{Binding UserDisplayName}" 
                               Foreground="White" FontWeight="Bold" Margin="0,10,0,0"/>
                    <TextBlock Text="{Binding CurrentUserRole}" 
                               Foreground="#A0B4D0" FontSize="12" Margin="0,5,0,0"/>
                </StackPanel>

         
                <StackPanel Grid.Row="1" Margin="10,40,10,0">
                    <ToggleButton x:Name="ObjectsToggle" Content="Объекты"
                                  Style="{StaticResource SidebarToggleButtonStyle}"
                                  Click="ObjectsToggle_Click" Height="47"/>

                
                    <ToggleButton x:Name="AgentObjectsToggle" Content="Управление объектами"
                                  Style="{StaticResource SidebarToggleButtonStyle}"
                                  Click="AgentObjectsToggle_Click" Height="47"
                                  Visibility="Collapsed"/>

                    <ToggleButton x:Name="UsersToggle" Content="Пользователи"
                                  Style="{StaticResource SidebarToggleButtonStyle}"
                                  Click="UsersToggle_Click" Height="47"/>

                    <ToggleButton x:Name="BookingToggle" Content="Бронь"
                                  Style="{StaticResource SidebarToggleButtonStyle}"
                                  Click="BookingToggle_Click" Height="47"/>

                    <ToggleButton x:Name="ContractsToggle" Content="Договоры"
                                  Style="{StaticResource SidebarToggleButtonStyle}"
                                  Click="ContractsToggle_Click" Height="47"/>

                    

                    <ToggleButton x:Name="Report1Toggle" Content="Отчет по прибыли"
                                  Style="{StaticResource SidebarToggleButtonStyle}"
                                  Click="Report1Toggle_Click" Height="47"/>
                </StackPanel>

                
            </Grid>
        </Border>


        <Border Grid.Column="1" Margin="20" Background="White" CornerRadius="10" Padding="20">
            <Grid x:Name="ContentGrid">

        
                <Grid x:Name="ObjectsPanel" Visibility="Collapsed">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Text="Объекты недвижимости" FontSize="20" FontWeight="Bold"/>

           
                    <Border Grid.Row="1" 
                            Background="#F5F8FF" 
                            CornerRadius="8" 
                            Margin="0,15,0,10" 
                            Padding="15"
                            BorderBrush="#E0E0E0"
                            BorderThickness="1">
                        <StackPanel>
                            <TextBlock Text="Фильтры поиска" 
                                       FontWeight="Bold" 
                                       FontSize="16" 
                                       Margin="0,0,0,15"
                                       Foreground="#1E3A63"/>

                            <WrapPanel Margin="0,5">
                            
                                <StackPanel Orientation="Horizontal" Margin="0,0,20,10">
                                    <TextBlock Text="Тип объекта:" 
                                               Style="{StaticResource FilterLabelStyle}"/>
                                    <ComboBox x:Name="ObjectTypeFilter" 
                                              Style="{StaticResource FilterComboBoxStyle}"
                                              ItemsSource="{Binding ObjectTypes}"
                              SelectedItem="{Binding SelectedObjectType, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                </StackPanel>

                             
                                <StackPanel Orientation="Horizontal" Margin="0,0,20,10">
                                    <TextBlock Text="Вид сделки:" 
                                               Style="{StaticResource FilterLabelStyle}"/>
                                    <ComboBox x:Name="DealTypeFilter" 
                                              Style="{StaticResource FilterComboBoxStyle}"
                                              ItemsSource="{Binding DealTypes}"
                                                SelectedItem="{Binding SelectedDealType, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                </StackPanel>

                             
                                <StackPanel Orientation="Horizontal" Margin="0,0,20,10">
                                    <TextBlock Text="Цена от:" 
                                         Style="{StaticResource FilterLabelStyle}"/>
                                    <TextBox x:Name="MinPriceFilter" 
                                         Style="{StaticResource FilterTextBoxStyle}"
                                         Text="{Binding MinPrice, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                </StackPanel>

                                <StackPanel Orientation="Horizontal" Margin="0,0,20,10">
                                    <TextBlock Text="Цена до:" 
                                        Style="{StaticResource FilterLabelStyle}"/>
                                    <TextBox x:Name="MaxPriceFilter" 
                                         Style="{StaticResource FilterTextBoxStyle}"
                                         Text="{Binding MaxPrice, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                </StackPanel>

                                
                            </WrapPanel>
                        </StackPanel>
                    </Border>

                   
                    <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,10,0,10">
                        <Button x:Name="RefreshObjectsBtn" Content="Обновить список" Background="#2196F3" 
                                Command="{Binding RefreshCommand}"
                                Style="{StaticResource ActionButtonStyle}"/>
                    </StackPanel>

                   
                    <ScrollViewer Grid.Row="3"
                                  VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Disabled"
                                  Padding="2">
                        <ItemsControl ItemsSource="{Binding Objects}"
                                      ItemTemplate="{StaticResource ObjectCardTemplate}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal" 
                                               Margin="10"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                        </ItemsControl>
                    </ScrollViewer>
                </Grid>

              
                <Grid x:Name="AgentObjectsPanel" Visibility="Collapsed">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Text="Управление объектами" FontSize="20" FontWeight="Bold"/>

               
                    <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,10,0,10">
                        <Button x:Name="AddObjectBtn" Content="Добавить" Background="#4CAF50" 
                                Command="{Binding AddObjectCommand}"
                                Style="{StaticResource ActionButtonStyle}"/>

                        <Button x:Name="EditObjectBtn" Content="Обновить" Background="#2196F3" 
                                Command="{Binding RefreshObjectsCommand}"
                                Style="{StaticResource ActionButtonStyle}"/>

                        <Button x:Name="DeleteObjectBtn" Content="Удалить" Background="#F44336" 
                                Command="{Binding DeleteObjectCommand}"
                                Style="{StaticResource ActionButtonStyle}"/>
                    </StackPanel>

                    
                    <DataGrid x:Name="AgentObjectsDataGrid"
                              Grid.Row="2"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              ItemsSource="{Binding Objects}" 
                              SelectedItem="{Binding SelectedObject, Mode=TwoWay}"
                              RowBackground="White"
                              AlternatingRowBackground="#F0F4FF"
                              GridLinesVisibility="All"
                              HeadersVisibility="Column"
                              CanUserResizeRows="False"
                              FontSize="14"
                              BorderBrush="#E0E0E0"
                              BorderThickness="1"
                              SelectionMode="Single"
                              SelectionUnit="FullRow"
                              HorizontalScrollBarVisibility="Auto"
                              VerticalScrollBarVisibility="Auto">
                        <DataGrid.Resources>
                            <Style TargetType="DataGridColumnHeader">
                                <Setter Property="Background" Value="#1E3A63"/>
                                <Setter Property="Foreground" Value="White"/>
                                <Setter Property="FontWeight" Value="Bold"/>
                                <Setter Property="Height" Value="40"/>
                                <Setter Property="HorizontalContentAlignment" Value="Center"/>
                            </Style>
                            <Style TargetType="DataGridRow">
                                <Setter Property="Height" Value="35"/>
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#DDE6F5"/>
                                    </Trigger>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background" Value="#1E3A63"/>
                                        <Setter Property="Foreground" Value="White"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </DataGrid.Resources>
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Адрес" Binding="{Binding Address}" Width="3*" MinWidth="200"/>
                            <DataGridTextColumn Header="Тип объекта" Binding="{Binding TypeOfSubjectName}" Width="*" MinWidth="100"/>
                            <DataGridTextColumn Header="Комнат" Binding="{Binding RoomCount, StringFormat={}{0}к.}" Width="80"/>
                            <DataGridTextColumn Header="Площадь" Binding="{Binding Area, StringFormat={}{0} м²}" Width="90"/>
                            <DataGridTextColumn Header="Тип сделки" Binding="{Binding TypeOfDealName}" Width="*" MinWidth="100"/>
                            <DataGridTextColumn Header="Цена" Binding="{Binding Price, StringFormat={}{0:N0} ₽}" Width="*" MinWidth="120"/>
                            <DataGridTextColumn Header="Статус" Binding="{Binding StatusName}" Width="*" MinWidth="100"/>
                            <DataGridTextColumn Header="Владелец" Binding="{Binding OwnerName}" Width="2*" MinWidth="150"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>

             
                <Grid x:Name="UsersPanel" Visibility="Collapsed">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Text="Пользователи" FontSize="20" FontWeight="Bold"/>

                    <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,10,0,10">
                        <Button x:Name="AddUserBtn" Content="Добавить" Background="#4CAF50" 
                                Style="{StaticResource ActionButtonStyle}"
                                Command="{Binding AddUserCommand}"/>

                        <Button x:Name="EditUserBtn" Content="Обновить" Background="#2196F3" 
                                Style="{StaticResource ActionButtonStyle}"
                                Command="{Binding RefreshUsersCommand}"/>

                        <Button x:Name="DeleteUserBtn" Content="Удалить" Background="#F44336" 
                                Style="{StaticResource ActionButtonStyle}"
                                Command="{Binding DeleteUserCommand}"/>
                    </StackPanel>

                    <DataGrid x:Name="UsersDataGrid"
                              Grid.Row="2"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              ItemsSource="{Binding Users}" 
                              SelectedItem="{Binding SelectedUser}"
                              RowBackground="White"
                              AlternatingRowBackground="#F0F4FF"
                              GridLinesVisibility="All"
                              HeadersVisibility="Column"
                              CanUserResizeRows="False"
                              FontSize="14"
                              BorderBrush="#E0E0E0"
                              BorderThickness="1"
                              SelectionMode="Single"
                              SelectionUnit="FullRow"
                              HorizontalScrollBarVisibility="Auto"
                              VerticalScrollBarVisibility="Auto">
                        <DataGrid.Resources>
                            <Style TargetType="DataGridColumnHeader">
                                <Setter Property="Background" Value="#1E3A63"/>
                                <Setter Property="Foreground" Value="White"/>
                                <Setter Property="FontWeight" Value="Bold"/>
                                <Setter Property="Height" Value="40"/>
                                <Setter Property="HorizontalContentAlignment" Value="Center"/>
                            </Style>
                            <Style TargetType="DataGridRow">
                                <Setter Property="Height" Value="35"/>
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#DDE6F5"/>
                                    </Trigger>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background" Value="#1E3A63"/>
                                        <Setter Property="Foreground" Value="White"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </DataGrid.Resources>
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ФИО" Binding="{Binding FullName}" Width="2*" MinWidth="150"/>
                            <DataGridTextColumn Header="Email" Binding="{Binding Email}" Width="2*" MinWidth="200"/>
                            <DataGridTextColumn Header="Телефон" Binding="{Binding PhoneNumber}" Width="*" MinWidth="100"/>
                            <DataGridTextColumn Header="Роль" Binding="{Binding TypeOfUser.Name}" Width="*" MinWidth="100"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>

           
                <Grid x:Name="BookingPanel" Visibility="Collapsed">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Text="Бронирования" FontSize="20" FontWeight="Bold"/>

                    <!-- Кнопки действий -->
                    <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,10,0,10">
                        <Button x:Name="CreateContractBtn" Content="Заключить договор" Background="#4CAF50" 
                Style="{StaticResource ActionButtonStyle}"
                Command="{Binding CreateContractCommand}"/>

                        <Button x:Name="DeleteBookingBtn" Content="Удалить" Background="#F44336" 
                Style="{StaticResource ActionButtonStyle}"
                Command="{Binding DeleteBookingCommand}"/>

                        <Button x:Name="RefreshBookingsBtn" Content="Обновить" Background="#2196F3" 
                Style="{StaticResource ActionButtonStyle}"
                Command="{Binding RefreshBookingsCommand}"/>
                    </StackPanel>

                 
                    <DataGrid x:Name="BookingsDataGrid"
              Grid.Row="2"
              AutoGenerateColumns="False"
              CanUserAddRows="False"
              ItemsSource="{Binding Bookings}" 
              SelectedItem="{Binding SelectedBooking, Mode=TwoWay}"
              RowBackground="White"
              AlternatingRowBackground="#F0F4FF"
              GridLinesVisibility="All"
              HeadersVisibility="Column"
              CanUserResizeRows="False"
              FontSize="14"
              BorderBrush="#E0E0E0"
              BorderThickness="1"
              SelectionMode="Single"
              SelectionUnit="FullRow"
              HorizontalScrollBarVisibility="Auto"
              VerticalScrollBarVisibility="Auto">
                        <DataGrid.Resources>
                            <Style TargetType="DataGridColumnHeader">
                                <Setter Property="Background" Value="#1E3A63"/>
                                <Setter Property="Foreground" Value="White"/>
                                <Setter Property="FontWeight" Value="Bold"/>
                                <Setter Property="Height" Value="40"/>
                                <Setter Property="HorizontalContentAlignment" Value="Center"/>
                            </Style>
                            <Style TargetType="DataGridRow">
                                <Setter Property="Height" Value="35"/>
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#DDE6F5"/>
                                    </Trigger>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background" Value="#1E3A63"/>
                                        <Setter Property="Foreground" Value="White"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </DataGrid.Resources>
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Объект" Binding="{Binding ObjectAddress}" Width="2*" MinWidth="150"/>
                            <DataGridTextColumn Header="Клиент" Binding="{Binding ClientName}" Width="*" MinWidth="120"/>
                            <DataGridTextColumn Header="Телефон" Binding="{Binding ClientPhone}" Width="120"/>
                            <DataGridTextColumn Header="Email" Binding="{Binding ClientEmail}" Width="*" MinWidth="150"/>
                            <DataGridTextColumn Header="Дата брони" Binding="{Binding BookingDateFormatted}" Width="100"/>
                            <DataGridTextColumn Header="Период" Binding="{Binding PeriodFormatted}" Width="150"/>
                            <DataGridTextColumn Header="Цена" Binding="{Binding Price, StringFormat={}{0:N0} ₽}" Width="120"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>

        
                <Grid x:Name="ContractsPanel" Visibility="Collapsed">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Text="Реестр договоров" FontSize="20" FontWeight="Bold"/>

                    <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,10,0,10">
                        <Button Content="Обновить список" 
                Background="#2196F3" 
                Style="{StaticResource ActionButtonStyle}"
                Click="ContractsToggle_Click"/>
                    </StackPanel>

                 
                    <DataGrid Grid.Row="2"
              ItemsSource="{Binding Contracts}"
              SelectedItem="{Binding SelectedContract}"
              AutoGenerateColumns="False"
              CanUserAddRows="False"
              RowBackground="White"
              AlternatingRowBackground="#F0F4FF"
              GridLinesVisibility="All"
              HeadersVisibility="Column"
              CanUserResizeRows="False"
              FontSize="14"
              BorderBrush="#E0E0E0"
              BorderThickness="1">

                        <DataGrid.Resources>
                            <Style TargetType="DataGridColumnHeader">
                                <Setter Property="Background" Value="#1E3A63"/>
                                <Setter Property="Foreground" Value="White"/>
                                <Setter Property="FontWeight" Value="Bold"/>
                                <Setter Property="Height" Value="40"/>
                                <Setter Property="HorizontalContentAlignment" Value="Center"/>
                            </Style>
                        </DataGrid.Resources>

                        <DataGrid.Columns>
                            <DataGridTextColumn Header="№" Binding="{Binding Id}" Width="50"/>
                            <DataGridTextColumn Header="Дата" Binding="{Binding SigningDate, StringFormat=dd.MM.yyyy}" Width="100"/>
                            <DataGridTextColumn Header="Клиент" Binding="{Binding ClientName}" Width="*" MinWidth="150"/>
                            <DataGridTextColumn Header="Объект" Binding="{Binding ObjectAddress}" Width="2*" MinWidth="200"/>
                            <DataGridTextColumn Header="Сумма" Binding="{Binding Amount, StringFormat={}{0:N0} ₽}" Width="120"/>

                            <DataGridTextColumn Header="Статус" Binding="{Binding StatusText}" Width="100"/>

                          
                            <DataGridTemplateColumn Header="Действия" Width="140">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                       
                                        <Button Content="Расторгнуть"
                                Command="{Binding DataContext.TerminateContractCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                IsEnabled="{Binding CanTerminate}"
                                Background="#F44336" 
                                Foreground="White"
                                Padding="5"
                                Margin="2"
                                BorderThickness="0"
                                Cursor="Hand"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>

               
                <Grid x:Name="DirectoriesPanel" Visibility="Collapsed">
                    <TextBlock Text="Справочники" FontSize="20" FontWeight="Bold"/>
                    <StackPanel Orientation="Horizontal" Margin="0,10,0,10">
                        <Button Content="Добавить" Background="#4CAF50" Style="{StaticResource ActionButtonStyle}"/>
                        <Button Content="Удалить" Background="#F44336" Style="{StaticResource ActionButtonStyle}"/>
                        <Button Content="Обновить" Background="#2196F3" Style="{StaticResource ActionButtonStyle}"/>
                    </StackPanel>
                </Grid>

                <Grid x:Name="Report1Panel" Visibility="Collapsed">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Text="Отчет по прибыли" 
                       FontSize="20" 
                       FontWeight="Bold"
                       Margin="0,0,0,20"/>

                  
                    <Border Grid.Row="1" 
                            Background="#F5F8FF" 
                            CornerRadius="8" 
                            Margin="0,0,0,20" 
                            Padding="15"
                            BorderBrush="#E0E0E0"
                            BorderThickness="1">
                        <StackPanel>
                            <TextBlock Text="Параметры отчета" 
                                       FontWeight="Bold" 
                                       FontSize="16" 
                                       Margin="0,0,0,15"
                                       Foreground="#1E3A63"/>

                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Год:" 
                                           VerticalAlignment="Center"
                                           Margin="0,0,10,0"
                                           Width="80"
                                           FontWeight="SemiBold"/>

                                <ComboBox ItemsSource="{Binding AvailableYears}"
                                          SelectedItem="{Binding SelectedYear, Mode=TwoWay}"
                                          Width="120"
                                          Height="35"
                                          VerticalContentAlignment="Center"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <StackPanel Grid.Row="2" 
                            Orientation="Horizontal" 
                            Margin="0,0,0,20">
                        <Button Content="Сформировать отчет" 
                                    Background="#2196F3" 
                                    Command="{Binding GenerateReportCommand}"
                                    IsEnabled="{Binding CanGenerateReport}"
                                    Style="{StaticResource ActionButtonStyle}"/>

                        <Button Content="Экспорт в PDF" 
                                Background="#4CAF50" 
                                Command="{Binding ExportToPdfCommand}"
                                IsEnabled="{Binding CanExportToPdf}"
                                Style="{StaticResource ActionButtonStyle}"/>

                        <Button Content="Обновить" 
                                Background="#FF9800" 
                                Command="{Binding RefreshCommand}"
                                IsEnabled="{Binding CanGenerateReport}"
                                Style="{StaticResource ActionButtonStyle}"/>
                    </StackPanel>

                    <Grid Grid.Row="3">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- График (Pie Chart) -->
                        <Border Grid.Column="0" 
                                Background="White" 
                                CornerRadius="8" 
                                Padding="20"
                                BorderBrush="#E0E0E0"
                                BorderThickness="1"
                                Margin="0,0,10,0">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <TextBlock Text="Распределение выручки по типам объектов"
                                           FontWeight="Bold"
                                           FontSize="16"
                                           Margin="0,0,0,20"
                                           HorizontalAlignment="Center"/>

                              
                                <StackPanel Grid.Row="1"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center">
                                    <TextBlock Text="{Binding TotalProfit, StringFormat='Общая выручка: {0:N0} ₽'}"
                                               FontWeight="Bold"
                                               FontSize="18"
                                               Foreground="#1E6F5C"
                                               Margin="0,0,0,10"/>

                                    <TextBlock Text="{Binding ProfitData.Count, StringFormat='Типов объектов: {0}'}"
                                               FontSize="14"
                                               Margin="0,0,0,20"/>

                                    <!-- Простой список типов объектов -->
                                    <ItemsControl ItemsSource="{Binding ProfitData}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Margin="0,5" 
                                                        Padding="10" 
                                                        Background="{Binding ChartColor}" 
                                                        CornerRadius="4">
                                                    <StackPanel>
                                                        <TextBlock Text="{Binding ObjectTypeName}" 
                                                                   FontWeight="Bold"
                                                                   Foreground="White"/>
                                                        <TextBlock Text="{Binding Profit, StringFormat='{}{0:N0} ₽ ({1:F1}%)'}" 
                                                                   Foreground="White"/>
                                                    </StackPanel>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </Grid>
                        </Border>

                      
                        <Border Grid.Column="1" 
                                Background="White" 
                                CornerRadius="8" 
                                Padding="20"
                                BorderBrush="#E0E0E0"
                                BorderThickness="1">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Text="Детализация"
                                           FontWeight="Bold"
                                           FontSize="16"
                                           Margin="0,0,0,20"/>

                             
                                <DataGrid Grid.Row="1"
                                          AutoGenerateColumns="False"
                                          CanUserAddRows="False"
                                          ItemsSource="{Binding ProfitData}" 
                                          RowBackground="White"
                                          AlternatingRowBackground="#F0F4FF"
                                          GridLinesVisibility="All"
                                          HeadersVisibility="Column"
                                          FontSize="14"
                                          BorderBrush="#E0E0E0"
                                          BorderThickness="1"
                                          MaxHeight="400"
                                          Width="450">
                                    <DataGrid.Resources>
                                        <Style TargetType="DataGridColumnHeader">
                                            <Setter Property="Background" Value="#1E3A63"/>
                                            <Setter Property="Foreground" Value="White"/>
                                            <Setter Property="FontWeight" Value="Bold"/>
                                            <Setter Property="Height" Value="35"/>
                                            <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                        </Style>
                                        <Style TargetType="DataGridRow">
                                            <Setter Property="Height" Value="35"/>
                                            <Style.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="#DDE6F5"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </DataGrid.Resources>
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Тип объекта" 
                                                            Binding="{Binding ObjectTypeName}" 
                                                            Width="2*"/>
                                        <DataGridTextColumn Header="Сделки" 
                                                            Binding="{Binding DealCount}" 
                                                            Width="*"/>
                                        <DataGridTextColumn Header="Выручка" 
                                                            Binding="{Binding Profit, StringFormat={}{0:N0} ₽}" 
                                                            Width="*"/>
                                        <DataGridTextColumn Header="Доля" 
                                                            Binding="{Binding Percentage, StringFormat={}{0:F1}%}" 
                                                            Width="*"/>
                                    </DataGrid.Columns>
                                </DataGrid>

                     
                                <Border Grid.Row="2"
                                        Background="#E8F5E9"
                                        CornerRadius="6"
                                        Padding="15"
                                        Margin="0,20,0,0">
                                    <TextBlock Text="{Binding TotalProfit, StringFormat='Общая выручка: {0:N0} ₽'}"
                                               FontWeight="Bold"
                                               FontSize="16"
                                               Foreground="#1E6F5C"/>
                                </Border>
                            </Grid>
                        </Border>
                    </Grid>

                </Grid>

            </Grid>
        </Border>
    </Grid>
</Window>